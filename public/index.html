<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="Vitamin English School Management System - Manage student attendance, lesson reports, and class schedules efficiently.">
    <meta name="keywords" content="school management, attendance tracking, lesson reports, education, English school">
    <meta name="author" content="Vitamin English School">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Vitamin English">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Vitamin English - School Management">
    <meta property="og:description" content="Modern school management system for tracking attendance, reports, and student progress.">
    
    <title>Vitamin English - School Management</title>
    
    <!-- Preconnect to external resources for performance -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <link rel="stylesheet" href="/css/styles.css">
    <!-- Flatpickr for Date/Time Pickers -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr" defer></script>
    <!-- Internationalization -->
    <script src="/js/i18n.js" defer></script>
    <!-- Monthly Reports Module -->
    <script src="/js/monthly-reports.js" defer></script>
</head>
<body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Login Screen -->
    <div id="login-screen" class="screen active" role="main">
        <div class="login-container">
            <div class="login-box" role="form" aria-label="Login form">
                <h1>üçä Vitamin English</h1>
                <h2>School Management System</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" required autofocus autocomplete="username" aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required autocomplete="current-password" aria-required="true">
                    </div>
                    <button type="submit" class="btn btn-primary btn-large">Login</button>
                    <div id="login-error" class="error-message" role="alert" aria-live="polite"></div>
                </form>
                <div class="login-info">
                    <p><strong>Demo Credentials:</strong></p>
                    <p>Admin: admin / admin123</p>
                    <p>Teacher: sarah / teacher123</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app-screen" class="screen">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                <h1>üçä Vitamin English</h1>
            </div>
            <div class="nav-menu">
                <button class="nav-item active" data-page="dashboard" data-i18n="nav.dashboard">Dashboard</button>
                <button class="nav-item" data-page="attendance" data-i18n="nav.attendance">Attendance</button>
                <button class="nav-item" data-page="reports" data-i18n="nav.reports">Teacher Comment Sheets</button>
                <button class="nav-item" data-page="monthly-reports" data-i18n="nav.monthlyReports">Monthly Reports</button>
                <button class="nav-item" data-page="students-profile" data-i18n="nav.students">Students</button>
                <button class="nav-item" data-page="makeup" data-i18n="nav.makeup">Make-up Lessons</button>
                <button class="nav-item" data-page="database" data-i18n="nav.database">Database</button>
                <button class="nav-item" data-page="admin" data-i18n="nav.admin">Admin</button>
            </div>
            <div class="nav-user">
                <button class="btn" id="lang-toggle" onclick="i18n.toggleLanguage()" style="font-size: 14px;" aria-label="Toggle language">üáØüáµ Êó•Êú¨Ë™û</button>
                <span id="user-name" aria-label="Current user"></span>
                <button id="profile-btn" class="btn btn-secondary" data-i18n="nav.profile" aria-label="User profile settings">‚öôÔ∏è Profile</button>
                <button id="logout-btn" class="btn btn-secondary" data-i18n="nav.logout" aria-label="Logout">Logout</button>
            </div>
        </nav>

        <!-- Main Content -->
        <main id="main-content" class="container" role="main">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page active">
                <h2>Dashboard</h2>
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>üìÖ Today's Classes</h3>
                        <div id="today-classes"></div>
                    </div>
                    <div class="dashboard-card">
                        <h3>‚ö° Quick Actions</h3>
                        <div class="quick-actions">
                            <button class="btn btn-primary" onclick="navigateToPage('attendance')">üìä Mark Attendance</button>
                            <button class="btn btn-primary" onclick="navigateToPage('reports')">üìù Add Teacher Comment Sheet</button>
                            <button class="btn btn-primary" onclick="navigateToPage('admin')">‚öôÔ∏è Manage Data</button>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h3>üìÜ Weekly Schedule</h3>
                        <div id="weekly-schedule"></div>
                    </div>
                    <div class="dashboard-card">
                        <h3>üîÑ Make-up Lessons</h3>
                        <div id="makeup-lessons-dashboard">
                            <p class="info-text">Loading make-up lessons...</p>
                        </div>
                        <button class="btn btn-primary btn-small" onclick="showMakeupLessonForm()">+ Schedule Make-up Lesson</button>
                    </div>
                    <div class="dashboard-card">
                        <h3>üìã Recent Activity</h3>
                        <div id="recent-activity"></div>
                    </div>
                </div>
            </div>

            <!-- Attendance Page -->
            <div id="attendance-page" class="page">
                <h2>Attendance Management</h2>
                
                <!-- New Attendance Sheet Button -->
                <button id="new-attendance-btn" class="btn btn-primary" style="margin-bottom: 20px;">
                    ‚ûï New Attendance Sheet
                </button>
                
                <div class="controls">
                    <div class="control-group">
                        <label>Class:</label>
                        <select id="attendance-class-select" class="form-control"></select>
                    </div>
                    <div class="control-group">
                        <label>Start Date:</label>
                        <input type="date" id="attendance-start-date" class="form-control">
                    </div>
                    <div class="control-group">
                        <label>End Date:</label>
                        <input type="date" id="attendance-end-date" class="form-control">
                    </div>
                    <button id="use-schedule-btn" class="btn btn-secondary" title="Auto-fill dates based on class schedule">üìÖ Use Schedule</button>
                    <button id="load-attendance-btn" class="btn btn-primary">Load Attendance</button>
                    <button id="export-attendance-btn" class="btn btn-secondary">Export CSV</button>
                    <button id="export-attendance-pdf-btn" class="btn btn-secondary">üìÑ Export PDF</button>
                </div>

                <!-- Attendance Metadata -->
                <div id="attendance-metadata" class="attendance-metadata" style="display: none;">
                    <div class="metadata-item">
                        <label>Class:</label>
                        <div class="value" id="metadata-class-name">-</div>
                    </div>
                    <div class="metadata-item">
                        <label>Date Range:</label>
                        <div class="value" id="metadata-date-range">-</div>
                    </div>
                    <div class="metadata-item">
                        <label>Teacher:</label>
                        <div class="value" id="metadata-teacher">-</div>
                    </div>
                    <div class="metadata-item">
                        <label>Students:</label>
                        <div class="value" id="metadata-student-count">-</div>
                    </div>
                    <div class="metadata-item">
                        <label>Class Time:</label>
                        <input type="text" id="attendance-time" class="form-control" placeholder="e.g., 14:00">
                    </div>
                    <div class="metadata-item">
                        <label>Taken by:</label>
                        <select id="attendance-taken-by" class="form-control">
                            <option value="">Select teacher...</option>
                        </select>
                    </div>
                </div>

                <!-- Attendance Controls -->
                <div id="attendance-controls" class="attendance-controls" style="display: none;">
                    <div class="view-toggle-group">
                        <span class="view-toggle-label">View:</span>
                        <button id="view-list-btn" class="view-toggle-btn active" title="List View">üìã List</button>
                        <button id="view-grid-btn" class="view-toggle-btn" title="Grid View">üìä Grid</button>
                    </div>
                    <button id="add-date-btn" class="add-date-btn">‚ûï Add Date</button>
                    <button id="move-attendance-btn" class="move-attendance-btn">üìÖ Move Attendance</button>
                    <div id="save-status-badge" class="save-status-badge" style="display: none;">
                        <span class="status-icon">üíæ</span>
                        <span class="status-text">Saved</span>
                    </div>
                </div>

                <div id="attendance-container" class="attendance-sheet">
                    <p class="info-text">Select a class and date range to view attendance</p>
                </div>
            </div>

            <!-- Teacher Comment Sheets Page -->
            <div id="reports-page" class="page">
                <h2>Teacher Comment Sheets</h2>
                
                <!-- Tab Navigation -->
                <div class="tab-navigation" role="tablist" aria-label="Report view options">
                    <button class="tab-btn active" data-tab="single-report" role="tab" aria-selected="true" aria-controls="single-report-tab">Single Report</button>
                    <button class="tab-btn" data-tab="multi-class" role="tab" aria-selected="false" aria-controls="multi-class-tab">Multi-Class View</button>
                </div>
                
                <!-- Single Report Tab -->
                <div id="single-report-tab" class="tab-content active" role="tabpanel" aria-labelledby="single-report-tab">
                    <div class="controls">
                        <div class="control-group">
                            <label>Class:</label>
                            <select id="reports-class-select" class="form-control"></select>
                        </div>
                        <div class="control-group">
                            <label>Date:</label>
                            <input type="date" id="report-date" class="form-control">
                        </div>
                        <button id="load-report-btn" class="btn btn-primary">Load Report</button>
                        <button id="new-report-btn" class="btn btn-success">New Report</button>
                    </div>

                    <div id="report-form-container" style="display: none;">
                        <form id="report-form" class="report-form">
                            <input type="hidden" id="report-id">
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Date *</label>
                                    <input type="date" id="report-form-date" required class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>Teacher *</label>
                                    <select id="report-teacher" required class="form-control"></select>
                                </div>
                                <div class="form-group">
                                    <label>Class *</label>
                                    <select id="report-class" required class="form-control"></select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Target/Topic</label>
                                <textarea id="report-target" rows="2" class="form-control"></textarea>
                            </div>

                            <div class="form-group">
                                <label>New Vocabulary/Phrases</label>
                                <textarea id="report-vocabulary" rows="3" class="form-control"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Mistakes (specific)</label>
                                <textarea id="report-mistakes" rows="3" class="form-control"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Strengths (specific)</label>
                                <textarea id="report-strengths" rows="3" class="form-control"></textarea>
                            </div>

                            <div class="form-group">
                                <label>Comments/Homework</label>
                                <textarea id="report-comments" rows="3" class="form-control"></textarea>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Save Report</button>
                                <button type="button" id="cancel-report-btn" class="btn btn-secondary">Cancel</button>
                                <button type="button" id="delete-report-btn" class="btn btn-danger" style="display: none;">Delete</button>
                                <button type="button" id="export-report-pdf-btn" class="btn btn-secondary" style="display: none;">Export PDF</button>
                            </div>
                        </form>
                    </div>

                    <div id="reports-list-container">
                        <h3>Recent Reports</h3>
                        <div id="reports-list"></div>
                    </div>
                </div>
                
                <!-- Multi-Class View Tab -->
                <div id="multi-class-tab" class="tab-content" role="tabpanel" aria-labelledby="multi-class-tab">
                    <div class="controls">
                        <div class="control-group">
                            <label>Select Classes:</label>
                            <div id="multi-class-selector" class="multi-select-container">
                                <!-- Checkboxes will be populated dynamically -->
                            </div>
                        </div>
                        <div class="control-group">
                            <label>Start Date:</label>
                            <input type="date" id="multi-start-date" class="form-control">
                        </div>
                        <div class="control-group">
                            <label>End Date:</label>
                            <input type="date" id="multi-end-date" class="form-control">
                        </div>
                        <button id="load-multi-reports-btn" class="btn btn-primary">Load Reports</button>
                        <button id="export-multi-pdf-btn" class="btn btn-success" style="display: none;">üìÑ Export All as PDF</button>
                    </div>
                    
                    <div id="multi-class-grid" class="multi-class-grid">
                        <p class="info-text">Select classes and date range, then click "Load Reports"</p>
                    </div>
                </div>
            </div>

            <!-- Monthly Reports Page -->
            <div id="monthly-reports-page" class="page">
                <h2>Monthly Reports</h2>
                
                <div class="controls">
                    <div class="control-group">
                        <label>Class:</label>
                        <select id="monthly-report-class-filter" class="form-control">
                            <option value="">All Classes</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Year:</label>
                        <select id="monthly-report-year-filter" class="form-control">
                            <option value="">All Years</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Month:</label>
                        <select id="monthly-report-month-filter" class="form-control">
                            <option value="">All Months</option>
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Status:</label>
                        <select id="monthly-report-status-filter" class="form-control">
                            <option value="">All Status</option>
                            <option value="draft">Draft</option>
                            <option value="published">Published</option>
                        </select>
                    </div>
                    <button id="filter-monthly-reports-btn" class="btn btn-primary">Filter</button>
                    <button id="new-monthly-report-btn" class="btn btn-success">+ Create Monthly Report</button>
                </div>

                <div id="monthly-reports-list" class="data-table">
                    <p class="info-text">Click "Filter" to load monthly reports</p>
                </div>
            </div>

            <!-- Student Profiles Page -->
            <div id="students-profile-page" class="page">
                <h2>Student Profiles</h2>
                <div class="controls">
                    <input type="text" id="student-search" class="form-control" placeholder="Search students...">
                    <select id="student-class-filter" class="form-control">
                        <option value="">All Classes</option>
                    </select>
                </div>
                <div id="students-profile-list" class="students-grid"></div>
            </div>

            <!-- Make-up Lessons Page -->
            <div id="makeup-page" class="page">
                <h2>Make-up Lessons</h2>
                
                <div class="controls">
                    <div class="control-group">
                        <label>Status:</label>
                        <select id="makeup-status-filter" class="form-control">
                            <option value="">All Status</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Student:</label>
                        <select id="makeup-student-filter" class="form-control">
                            <option value="">All Students</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Start Date:</label>
                        <input type="date" id="makeup-start-date" class="form-control">
                    </div>
                    <div class="control-group">
                        <label>End Date:</label>
                        <input type="date" id="makeup-end-date" class="form-control">
                    </div>
                    <button id="filter-makeup-btn" class="btn btn-primary">Filter</button>
                    <button id="new-makeup-btn" class="btn btn-success">+ Schedule Make-up Lesson</button>
                </div>

                <div id="makeup-lessons-container" class="data-table">
                    <p class="info-text">Click "Filter" to load make-up lessons or use filters to search</p>
                </div>
            </div>

            <!-- Database Viewer Page -->
            <div id="database-page" class="page">
                <h2>Database Viewer</h2>
                
                <!-- Simplified Search Container -->
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <input type="text" id="db-search-input" class="form-control search-input" placeholder="Search students, classes, reports..." aria-label="Search database">
                    </div>
                    <button id="db-advanced-toggle" class="btn btn-secondary">Advanced ‚ñº</button>
                </div>

                <!-- Filter Pills -->
                <div class="search-filter-pills">
                    <button class="filter-pill active" data-type="" aria-label="Filter by all types">All</button>
                    <button class="filter-pill" data-type="students" aria-label="Filter by students">üë®‚Äçüéì Students</button>
                    <button class="filter-pill" data-type="classes" aria-label="Filter by classes">üìö Classes</button>
                    <button class="filter-pill" data-type="reports" aria-label="Filter by reports">üìù Reports</button>
                    <button class="filter-pill" data-type="attendance" aria-label="Filter by attendance">‚úì Attendance</button>
                    <button class="filter-pill" data-type="makeup_lessons" aria-label="Filter by make-up lessons">üîÑ Make-up</button>
                </div>

                <!-- Advanced Search Options (Hidden by Default) -->
                <div id="db-advanced-options" class="advanced-search-options">
                    <div class="controls">
                        <div class="control-group">
                            <label>Start Date:</label>
                            <input type="date" id="db-search-start-date" class="form-control">
                        </div>
                        <div class="control-group">
                            <label>End Date:</label>
                            <input type="date" id="db-search-end-date" class="form-control">
                        </div>
                    </div>
                    <div class="controls" style="margin-top: 10px;">
                        <select id="db-table-select" class="form-control">
                            <option value="students">Students</option>
                            <option value="classes">Classes</option>
                            <option value="attendance">Attendance</option>
                            <option value="teacher_comment_sheets">Teacher Comment Sheets</option>
                            <option value="makeup_lessons">Make-up Lessons</option>
                            <option value="users">Users</option>
                        </select>
                        <button id="db-load-btn" class="btn btn-primary">Load Table</button>
                    </div>
                </div>

                <!-- Export Buttons -->
                <div class="export-buttons" style="margin-top: 12px; margin-bottom: 12px;">
                    <button id="db-export-csv-btn" class="btn btn-secondary">üìä Export CSV</button>
                    <button id="db-export-pdf-btn" class="btn btn-secondary">üìÑ Export PDF</button>
                </div>

                <!-- Hidden Search Type (Used by JS) -->
                <input type="hidden" id="db-search-type" value="">

                <div id="db-viewer-container" class="db-viewer">
                    <p class="info-text">Start typing to search...</p>
                </div>
            </div>

            <!-- Profile/Settings Page -->
            <div id="profile-page" class="page">
                <h2>Profile Settings</h2>
                <div class="profile-container">
                    <div class="profile-card">
                        <h3>User Information</h3>
                        <p><strong>Username:</strong> <span id="profile-username"></span></p>
                        <p><strong>Full Name:</strong> <span id="profile-fullname"></span></p>
                        <p><strong>Role:</strong> <span id="profile-role"></span></p>
                    </div>
                    
                    <div class="profile-card">
                        <h3>Change Password</h3>
                        <form id="change-password-form">
                            <div class="form-group">
                                <label>Current Password *</label>
                                <input type="password" id="current-password" required class="form-control">
                            </div>
                            <div class="form-group">
                                <label>New Password *</label>
                                <input type="password" id="new-password" required class="form-control" minlength="6">
                            </div>
                            <div class="form-group">
                                <label>Confirm New Password *</label>
                                <input type="password" id="confirm-password" required class="form-control" minlength="6">
                            </div>
                            <button type="submit" class="btn btn-primary">Update Password</button>
                            <div id="password-message" class="message"></div>
                        </form>
                    </div>

                    <div class="profile-card">
                        <h3>Change Username</h3>
                        <form id="change-username-form">
                            <div class="form-group">
                                <label>New Username *</label>
                                <input type="text" id="new-username" required class="form-control" minlength="3">
                            </div>
                            <div class="form-group">
                                <label>Confirm Password *</label>
                                <input type="password" id="username-password" required class="form-control">
                            </div>
                            <button type="submit" class="btn btn-primary">Update Username</button>
                            <div id="username-message" class="message"></div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Admin Page -->
            <div id="admin-page" class="page">
                <h2>Administration</h2>
                
                <div class="admin-tabs">
                    <button class="tab-btn active" data-tab="students">Students</button>
                    <button class="tab-btn" data-tab="classes">Classes</button>
                    <button class="tab-btn" data-tab="teachers">Teachers</button>
                </div>

                <!-- Students Tab -->
                <div id="students-tab" class="tab-content active">
                    <div class="tab-header">
                        <h3>Manage Students</h3>
                        <button id="add-student-btn" class="btn btn-success">+ Add Student</button>
                    </div>
                    <div id="students-list" class="data-table"></div>
                </div>

                <!-- Classes Tab -->
                <div id="classes-tab" class="tab-content">
                    <div class="tab-header">
                        <h3>Manage Classes</h3>
                        <button id="add-class-btn" class="btn btn-success">+ Add Class</button>
                    </div>
                    <div id="classes-list" class="data-table"></div>
                </div>

                <!-- Teachers Tab -->
                <div id="teachers-tab" class="tab-content">
                    <div class="tab-header">
                        <h3>Manage Teachers</h3>
                        <button id="add-teacher-btn" class="btn btn-success">+ Add Teacher</button>
                    </div>
                    <div id="teachers-list" class="data-table"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for editing -->
    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close modal">&times;</button>
            <h3 id="modal-title"></h3>
            <div id="modal-body"></div>
        </div>
    </div>

    <script src="/js/app.js"></script>
</body>
</html>
